<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="description" content="WebARã‚’åˆ©ç”¨ã—ã¦ã€ãƒãƒ¼ã‚«ãƒ¼ã‚’èª­ã¿å–ã‚‹ã¨å‹•ç”»ãŒå†ç”Ÿã•ã‚Œã‚‹ARä½“é¨“ãŒã§ãã¾ã™ã€‚ã‚¹ãƒãƒ›ã‚«ãƒ¡ãƒ©ã§æ‰‹è»½ã«ä½“é¨“ãŒå¯èƒ½ã§ã™ã€‚">


    <title>WebARå‹•ç”» | TOP</title>

    <!-- CSS -->
    <link rel="stylesheet" href="./css/style.css" />

    <!-- PWA -->
    <link rel="manifest" href="./manifest.json">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="apple-mobile-web-app-title" content="WebAR">
    <link rel="apple-touch-icon" href="./assets/images/icon-192.png">

    <!-- äº‹å‰ãƒ­ãƒ¼ãƒ‰ -->
    <!-- é«˜å„ªå…ˆåº¦ -->
    <link rel="preload" as="fetch" href="./assets/markers/marker-ptn01.patt" crossorigin="anonymous">
    <link rel="preload" as="fetch" href="./assets/markers/marker-ptn02.patt" crossorigin="anonymous">
    <link rel="preload" as="fetch" href="./assets/markers/marker-ptn03.patt" crossorigin="anonymous">
    
    <!-- é…å»¶å‹•ç”» -->
    <link rel="prefetch" as="video" href="./assets/videos/video-01.mp4" type="video/mp4">
    <link rel="prefetch" as="video" href="./assets/videos/video-02.mp4" type="video/mp4">
    <link rel="prefetch" as="video" href="./assets/videos/video-03.mp4" type="video/mp4">


    <!-- ãƒ©ã‚¤ãƒ–ãƒ©ãƒª -->
    <script src="https://aframe.io/releases/1.4.2/aframe.min.js"></script>
    <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar.js"></script>

    <!-- JavaScript -->
    <script src="./js/core/loadingManager.js" defer></script>
    <script src="./js/core/statusDisplay.js" defer></script>
    <script src="./js/video/videoPlayer.js" defer></script>
    <script src="./js/video/videoPlane.js" defer></script>
    <script src="./js/ar/arMarker.js" defer></script>
    <script src="./js/ar/arSceneManager.js" defer></script>

    <!-- ãƒ•ã‚¡ãƒ“ã‚³ãƒ³ -->
    <link rel="icon" href="./favicon.ico" type="image/x-icon" />
</head>
<body>
    <header class="fixed-header">
        <div class="header-content">
            <div class="header-logo">
                <a href="./index.html">WebAR</a>
            </div>
            <nav class="header-nav">
                <ul>
                    <li><a href="./pages/guide.html">ä½¿ã„æ–¹</a></li>
                    <li><a href="./pages/benefit.html">ç‰¹å…¸</a></li>
                    <li><a href="./pages/information.html">å‹•ä½œç’°å¢ƒ</a></li>
                </ul>
            </nav>
        </div>
        <div class="header-debug">
            <p id="status-text">ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹: å¾…æ©Ÿä¸­</p>
        </div>
    </header>

    <main>
        <div id="interaction-overlay">
            <div class="interaction-prompt">
                <p>ã‚«ãƒ¡ãƒ©ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹ã¨ARä½“é¨“ã‚’é–‹å§‹ã™ã‚‹ã«ã¯ã€<br/>
                    "ARä½“é¨“ã‚’é–‹å§‹" ã‚’ã‚¿ãƒƒãƒ—ï¼<br>
                    <br>ã€åˆ©ç”¨æ–¹æ³•ã€‘<br>
                    1. ãƒãƒ¼ã‚«ãƒ¼ã‹ã‚‰15-30cm é›¢ã—ã¦ã‚«ãƒ¡ãƒ©ã‚’å‘ã‘ã‚‹<br>
                    2. ãƒãƒ¼ã‚«ãƒ¼ãŒèªè­˜ã•ã‚Œã‚‹ã¨å‹•ç”»ãŒå†ç”Ÿã•ã‚Œã¾ã™<br>
                    3. å†ç”Ÿã§ããªã„æ™‚ã¯ã€ã€Œç‰¹å…¸ã€ãƒšãƒ¼ã‚¸ã‚’è¦‹ã¦ã­<br>
                    <br><small>â€»ã‚«ãƒ¡ãƒ©æ¨©é™ã®è¨±å¯ãŒæ±‚ã‚ã‚‰ã‚ŒãŸå ´åˆã¯ã€Œè¨±å¯ã€ã‚’é¸æŠã—ã¦ãã ã•ã„</small>
                </p>
                <button id="start-ar-btn">ARä½“é¨“ã‚’é–‹å§‹</button>
            </div>
        </div>

        <div id="loading">
            <div class="progress-container">
                <div class="progress-bar">
                    <div class="progress-fill"></div>
                </div>
                <div id="loading-percentage">Loading: 0%</div>
                <div class="loading-status">ARã‚«ãƒ¡ãƒ©ã‚’åˆæœŸåŒ–ä¸­...</div>
            </div>
        </div>
    </main>

    <a-scene
        id="ar-scene"
        embedded
        arjs="
        sourceType: webcam;
        debugUIEnabled: false;
        detectionMode: mono_and_matrix;
        matrixCodeType: 3x3;
        patternRatio: 0.8;
        maxDetectionRate: 60;
        trackingMethod: best;
        sourceWidth: 640;
        sourceHeight: 480;
        displayWidth: 640;
        displayHeight: 480;"
        style="width: 100vw; height: 100vh; overflow: hidden; display: none; position: fixed; top: 0; left: 0;"
        vr-mode-ui="enabled: false"
        device-orientation-permission-ui="enabled: false"
        gesture-detector
        raycaster="objects: .clickable"
    >
        <a-assets>
            <video id="video-01" 
                src="./assets/videos/video-01.mp4" 
                loop 
                muted 
                playsinline 
                preload="none"
                crossorigin="anonymous"
                webkit-playsinline="true"></video>
            <video id="video-02" 
                src="./assets/videos/video-02.mp4" 
                loop 
                muted 
                playsinline 
                preload="none"
                crossorigin="anonymous"
                webkit-playsinline="true"></video>
            <video id="video-03" 
                src="./assets/videos/video-03.mp4" 
                loop 
                muted 
                playsinline 
                preload="none"
                crossorigin="anonymous"
                webkit-playsinline="true"></video>
        </a-assets>

        <a-marker type="pattern" url="./assets/markers/marker-ptn01.patt" id="marker-01" 
                patternRatio="0.8" 
                smooth="true" 
                smoothCount="10" 
                smoothTolerance="0.05" 
                smoothThreshold="5"
                raycaster="objects: .clickable">
            <a-plane id="plane-01" 
                        position="0 0 0.01" 
                        rotation="-90 0 0" 
                        width="1.8" 
                        height="1.0125"
                        material="src: #video-01; shader: flat; transparent: true; opacity: 0"
                        visible="false"></a-plane>
        </a-marker>

        <a-marker type="pattern" url="./assets/markers/marker-ptn02.patt" id="marker-02" 
                patternRatio="0.8" 
                smooth="true" 
                smoothCount="10" 
                smoothTolerance="0.05" 
                smoothThreshold="5"
                raycaster="objects: .clickable">
            <a-plane id="plane-02" 
                        position="0 0 0.01" 
                        rotation="-90 0 0" 
                        width="1.8" 
                        height="1.0125"
                        material="src: #video-02; shader: flat; transparent: true; opacity: 0"
                        visible="false"></a-plane>
        </a-marker>

        <a-marker type="pattern" url="./assets/markers/marker-ptn03.patt" id="marker-03" 
                patternRatio="0.8" 
                smooth="true" 
                smoothCount="10" 
                smoothTolerance="0.05" 
                smoothThreshold="5"
                raycaster="objects: .clickable">
            <a-plane id="plane-03" 
                        position="0 0 0.01" 
                        rotation="-90 0 0" 
                        width="1.8" 
                        height="1.0125"
                        material="src: #video-03; shader: flat; transparent: true; opacity: 0"
                        visible="false"></a-plane>
        </a-marker>

        <a-entity camera></a-entity>
    </a-scene>

    <script>
        // Android Chrome/Edgeæ¤œå‡ºã¨bodyã‚¯ãƒ©ã‚¹è¿½åŠ 
        document.addEventListener("DOMContentLoaded", () => {
            const userAgent = navigator.userAgent;
            if (/Android.*Chrome/i.test(userAgent)) {
                document.body.classList.add('android-chrome');
                console.log("Detected Android Chrome");
            } else if (/Android.*Edge/i.test(userAgent)) {
                document.body.classList.add('android-edge');
                console.log("Detected Android Edge");
            }
        });
    </script>

    <script>
        document.addEventListener("DOMContentLoaded", () => {
            console.log("DOM loaded, initializing AR scene...");
            
            const sceneManager = new ARSceneManager({
                loadingSelector: "#loading",
                statusSelector: "#status-text",
                interactionOverlaySelector: "#interaction-overlay"
            });

            // ã‚°ãƒ­ãƒ¼ãƒãƒ«ã‚¢ã‚¯ã‚»ã‚¹ç”¨ï¼ˆãƒ‡ãƒãƒƒã‚°ç›®çš„ï¼‰
            window.arSceneManager = sceneManager;

            // ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ã‚·ãƒ§ãƒ³ã§ARé–‹å§‹
            const startBtn = document.getElementById("start-ar-btn");
            startBtn.addEventListener("click", async () => {
                console.log("Start AR button clicked");
                try {
                    await sceneManager.startAR();
                } catch (error) {
                    console.error("Failed to start AR:", error);
                }
            });

            // A-Frameã‚·ãƒ¼ãƒ³ã®ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°
            const arScene = document.getElementById("ar-scene");
            arScene.addEventListener("enter-vr", () => {
                console.log("AR scene entered");
            });

            arScene.addEventListener("exit-vr", () => {
                console.log("AR scene exited");
            });

            // ãƒ‡ãƒãƒƒã‚°ç”¨ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆï¼ˆãƒ‡ã‚¹ã‚¯ãƒˆãƒƒãƒ—ã®ã¿ï¼‰
            document.addEventListener("keydown", (event) => {
                if (!sceneManager.isARReady) return;
                
            switch(event.key) {
                case 'd': // ãƒ‡ãƒãƒƒã‚°æƒ…å ±è¡¨ç¤º
                    sceneManager.debugMarkerPositions();
                    break;
                case 'r': // ä½ç½®ãƒªã‚»ãƒƒãƒˆ
                    console.log("Position reset disabled in single marker mode");
                    break;
                case 'c': // ç¾åœ¨ã®ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãƒãƒ¼ã‚«ãƒ¼è¡¨ç¤º
                    console.log("Current active marker:", sceneManager.currentActiveMarker);
                    break;
                case 's': // å˜ä¸€è¡¨ç¤ºãƒ¢ãƒ¼ãƒ‰ã®çŠ¶æ…‹ç¢ºèª
                    console.log("Single marker mode status:", {
                        maxSimultaneous: sceneManager.maxSimultaneousMarkers,
                        currentActive: sceneManager.currentActiveMarker,
                        conflictDetection: sceneManager.conflictDetectionEnabled
                    });
                    break;
                case 't': // ğŸ†• ãƒãƒ¼ã‚«ãƒ¼æ¤œå‡ºãƒ†ã‚¹ãƒˆ
                    console.log("Testing marker detection...");
                    sceneManager.checkMarkerStatus();
                    break;
                case 'm': // ğŸ†• æ‰‹å‹•ãƒãƒ¼ã‚«ãƒ¼ã‚¢ã‚¯ãƒ†ã‚£ãƒ™ãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆãƒ†ã‚¹ãƒˆç”¨ï¼‰
                    console.log("Manual marker activation test");
                    const testMarker = sceneManager.instances[0];
                    if (testMarker) {
                        testMarker.arMarker.activateMarker();
                    }
                    break;
                    // case '1': // ãƒãƒ¼ã‚«ãƒ¼01ã®ä½ç½®èª¿æ•´ï¼ˆç„¡åŠ¹åŒ–ï¼‰
                    // case '2': // ãƒãƒ¼ã‚«ãƒ¼02ã®ä½ç½®èª¿æ•´ï¼ˆç„¡åŠ¹åŒ–ï¼‰
                    // case '3': // ãƒãƒ¼ã‚«ãƒ¼03ã®ä½ç½®èª¿æ•´ï¼ˆç„¡åŠ¹åŒ–ï¼‰
                }
            });

            console.log("Event listeners attached with single marker debug controls");
            console.log("Debug keys: d=debug info, c=current marker, s=single mode status");
        });
    </script>

    <!-- ã‚­ãƒ£ãƒƒã‚·ãƒ¥ç™»éŒ²: ãƒˆãƒƒãƒ—ç”»é¢ãƒ»ã‚¬ã‚¤ãƒ‰ãƒ»å‹•ç”»ãƒ•ã‚¡ã‚¤ãƒ« -->
    <script>
    if ('serviceWorker' in navigator) {
    navigator.serviceWorker.register('./js/core/serviceWorker.js')
        .then(() => console.log("Service Worker registered"))
        .catch(err => console.error("SW registration failed:", err));
    }
    </script>

    <!-- Googleå‘ã‘SEO: JSON-LDæ§‹é€ åŒ–ãƒ‡ãƒ¼ã‚¿ -->
    <script type="application/ld+json">
    {
    "@context": "https://schema.org",
    "@type": "SoftwareApplication",
    "name": "WebAR Video Experience",
    "operatingSystem": "Android, iOS",
    "applicationCategory": "AugmentedRealityApplication",
    "description": "ãƒãƒ¼ã‚«ãƒ¼ã‚’èª­ã¿å–ã‚‹ã¨å‹•ç”»ãŒå†ç”Ÿã•ã‚Œã‚‹WebARä½“é¨“ã‚¢ãƒ—ãƒª",
    "url": "https://example.com/"
    }
    </script>
</body>
</html>